---
import headlineFrame from '../assets/images/decorations/headline-frame.svg'
import { cn } from '@/utils/cn'

interface Props {
  headline?: string
  modelNumber?: string
  title: string
  copy?: string
  description?: string
  colors?: string[]
  sizes?: string[]
  price?: string
  link?: string
  totalPages: number
  carouselId: string
}

const {
  headline,
  modelNumber,
  title,
  copy,
  description,
  colors = [],
  sizes = [],
  price,
  link,
  totalPages,
  carouselId,
} = Astro.props

// ®記号を上付きのspanタグに変換する関数
const formatRegisteredMark = (text: string | undefined) => {
  if (!text) return ''
  return text.replace(/®/g, '<span class="text-[0.9em] align-top">®</span>')
}
---

<article
  class="bg-cream-dark p-6 h-full flex flex-col justify-between min-h-full border border-light-navy"
>
  <div>
    {
      headline && (
        <div class="inline-block mb-4">
          <span
            class="inline-block bg-no-repeat bg-center p-[0.5em] text-[0.694vw] lg:text-[10px] font-light uppercase tracking-[0.1em] text-brown whitespace-nowrap min-w-[62px] min-h-[20px] leading-none"
            style={`background-image: url(${headlineFrame.src}); background-size: 100% 100%;`}
          >
            {headline}
          </span>
        </div>
      )
    }

    {
      modelNumber && (
        <p class="text-xs text-tape-navy-dark font-light mb-2">{modelNumber}</p>
      )
    }

    <h3
      class="font-sans text-[2.2vw] font-medium text-tape-navy-dark mb-3 tracking-tight"
    >
      {title}
    </h3>

    {price && <p class="text-[0.972vw] font-medium text-brown mb-6">{price}</p>}

    {
      copy && (
        <p class="text-[1.25vw] font-bold text-tape-navy-dark mb-4">{copy}</p>
      )
    }

    {
      description && (
        <p
          class="text-[1.1vw] text-tape-navy-dark mb-4 leading-[1.75] font-normal font-sans-jp"
          set:html={formatRegisteredMark(description)}
        />
      )
    }

    {
      link && (
        <a
          href={link}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block text-[2.2vw] text-brown hover:no-underline transition-all font-extralight"
        >
          BUY
        </a>
      )
    }
  </div>

  <!-- Pagination -->
  <div class="pager flex gap-0" data-carousel-pagination={carouselId}>
    {
      Array.from({ length: totalPages }, (_, i) => (
        <button
          class={cn(
            'relative z-[1] px-3 py-2 text-sm bg-white border border-gray-300',
            'hover:bg-gray-50 transition-colors',
            'first:rounded-l last:rounded-r -ml-px first:ml-0',
            '[&.is-active]:bg-navy [&.is-active]:text-white [&.is-active]:border-navy [&.is-active]:z-[2]'
          )}
          data-page={i}
          aria-label={`Go to page ${i + 1}`}
        >
          {i + 1}
        </button>
      ))
    }
  </div>
</article>
