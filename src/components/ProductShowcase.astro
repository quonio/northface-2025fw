---
import { Image } from 'astro:assets'
import ProductInfoCard from './ProductInfoCard.astro'
import { cn } from '@/utils/cn'

export interface ProductData {
  headline?: string
  modelNumber?: string
  title: string
  copy?: string
  description?: string
  price?: string
  link?: string
}

interface SingleProductProps {
  image: ImageMetadata
  imageAlt: string
  headline?: string
  modelNumber?: string
  title: string
  copy?: string
  description?: string
  price?: string
  link?: string
  products?: never
  reverse?: boolean
  size?: 'sm' | 'md' | 'lg'
  class?: string
}

interface MultipleProductProps {
  image: ImageMetadata
  imageAlt: string
  products: ProductData[]
  headline?: never
  modelNumber?: never
  title?: never
  copy?: never
  description?: never
  price?: never
  link?: never
  reverse?: boolean
  size?: 'sm' | 'md' | 'lg'
  class?: string
}

type Props = SingleProductProps | MultipleProductProps

const props = Astro.props as Props
const {
  image,
  imageAlt,
  reverse = false,
  size = 'sm',
  class: className = '',
} = props

// 単一商品か複数商品かを判定
const isSingleProduct = !('products' in props)

// 商品データの配列を生成
const productDataArray: ProductData[] = isSingleProduct
  ? [{
      headline: (props as SingleProductProps).headline,
      modelNumber: (props as SingleProductProps).modelNumber,
      title: (props as SingleProductProps).title,
      copy: (props as SingleProductProps).copy,
      description: (props as SingleProductProps).description,
      price: (props as SingleProductProps).price,
      link: (props as SingleProductProps).link,
    }]
  : (props as MultipleProductProps).products
---

<div
  class={cn(
    'flex flex-col items-start',
    reverse ? 'md:flex-row-reverse' : 'md:flex-row',
    className
  )}
>
  <div class="w-full md:w-[20.833vw]">
    <Image
      src={image}
      alt={imageAlt}
      class="w-full h-auto object-cover border border-light-navy"
    />
  </div>
  <div class="w-full md:w-[20.833vw] -ml-px">
    {productDataArray.length === 1 ? (
      <ProductInfoCard
        headline={productDataArray[0].headline}
        modelNumber={productDataArray[0].modelNumber}
        title={productDataArray[0].title}
        copy={productDataArray[0].copy}
        description={productDataArray[0].description}
        price={productDataArray[0].price}
        link={productDataArray[0].link}
        size={size}
      />
    ) : (
      <div class="flex flex-col">
        {productDataArray.map((product, index) => (
          <div class={index > 0 ? '-mt-px' : ''}>
            <ProductInfoCard
              headline={product.headline}
              modelNumber={product.modelNumber}
              title={product.title}
              copy={product.copy}
              description={product.description}
              price={product.price}
              link={product.link}
              size={size}
            />
          </div>
        ))}
      </div>
    )}
  </div>
</div>