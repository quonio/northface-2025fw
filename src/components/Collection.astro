---
import ProductCarousel from './ProductCarousel.astro'
import ProductShowcase from './ProductShowcase.astro'
import { cn } from '@/utils/cn'
import type { ProductInfo, CarouselItem } from './ProductCarousel.astro'
// Import style images
import style01 from '@/assets/images/img-style-01.jpg'
import style02 from '@/assets/images/img-style-02.jpg'
import style03 from '@/assets/images/img-style-03.jpg'
import style04 from '@/assets/images/img-style-04.jpg'
import style05 from '@/assets/images/img-style-05.jpg'
import style06 from '@/assets/images/img-style-06.jpg'
import placeholderImage from '@/assets/images/main-kv.jpg'

// Import unit images
import unit01 from '@/assets/images/img-collection-unit-01.png'
import unit02 from '@/assets/images/img-collection-unit-02.png'
import unit03 from '@/assets/images/img-collection-unit-03.png'
import unit04 from '@/assets/images/img-collection-unit-04.png'
import unit05 from '@/assets/images/img-collection-unit-05.png'

// Import new collection images
import collection7 from '@/assets/images/img-collection-7-1.jpg'
import collection8 from '@/assets/images/img-collection-8-1.jpg'

interface Props {
  class?: string
}

const { class: className = '' } = Astro.props

// Create carousel data for each row
const productInfos: ProductInfo[] = [
  {
    headline: 'UNISEX',
    modelNumber: 'NYM82510',
    title: 'CR Move Insulation Jacket',
    copy: '抱っこ対応のユニセックスモデルの中わたジャケット',
    description:
      'ベビーカバー（ダッカー）をフロントに装着することで、子どもを抱いた上から着用することができるジャケット。ベビーカバーは単体でも使用でき、内側は子どもの肌に心地よいフリース素材仕様。子どもの成長後はダッカーを外して単体でのジャケット着用が可能。3色展開。',
    price: '¥44,000 (Tax incl.)',
    link: 'https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NYM82510',
  },
  {
    headline: 'WOMENS',
    modelNumber: 'NYM82510',
    title: 'Maternity Insulation Jacket',
    copy: '身幅の調整が可能な、保温性を備えた中綿ロングコート',
    description:
      'ゆとりのあるシルエットとドットボタンでの調整で、お腹の大きくなる妊娠中から、子どもの成長後まで長期間の着用が可能。産後は小さな子供を抱っこした際に上から着用でき、子供の顔を出すことを想定して、襟元はVネックにも変化可能な2WAY仕様。2色展開。',
    price: '¥41,800 (Tax incl.)',
    link: 'https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NYM82510',
  },
  {
    headline: 'UNISEX',
    modelNumber: 'NPM62510',
    title: 'CR Storage Jacket',
    copy: '手ぶらでのお出かけを叶える、抱っこ対応・収納力に優れるジャケット',
    description:
      '「極力バッグは持ちたくない」というパパの実際の声から生まれた、10個のポケットを備えるジャケット。ベビーカバー（ダッカー）をフロントに装着することで抱っこに対応。カバーを外せば収納力のある防水ジャケットとして単体で着用ができる。表地にはGORE-TEXを使用。2色展開。',
    price: '¥66,000 (Tax incl.)',
    link: 'https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NPM62510',
  },
  {
    headline: 'WOMENS',
    modelNumber: 'NDM92501',
    title: 'Maternity Down Coat',
    copy: '妊娠中も産後もベビーと一緒に着用できるダウンコート',
    description:
      '防風性・はっ水性に優れた柔らかな手触りのGORE-TEX WINDSTOPPER®️の内側に、光電子®️ダウンをたっぷり封入した保温性に優れたダウンジャケット。お腹の大きくなる妊娠中から、子どもの成長後まで長期間の着用が可能。ベビーキャリアカバーを連結すれば子どもを抱っこしたまま着用でき、単体でもベビーカーや抱っこひもに装着できる。2色展開。',
    price: '¥93,500 (Tax incl.)',
    link: 'https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NDM92501',
  },
  {
    headline: 'UNISEX',
    modelNumber: 'NTM62510',
    title: 'CR Sweat Crew',
    copy: '抱っこひも使用時にも着用しやすい、食品防汚に対応したスウェット',
    description:
      '袖と背面に配したポケットは抱っこひも使用時にも使いやすい配置。背面ポケットには左右どちらからでもアプローチでき、両脇ファスナーを開くことにより、抱っこひものヒップベルトの干渉が少なく使用できる。3色展開。',
    price: '¥17,600 (Tax incl.)',
    link: 'https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NTM62510',
  },
]

// Create items for carousels using style images
const createCarouselItems = (startIndex: number): CarouselItem[] => {
  const images = [style01, style02, style03, style04, style05, style06]
  return Array.from({ length: 6 }, (_, i) => ({
    id: `item-${startIndex}-${i}`,
    image: images[i],
    alt: `THE NORTH FACE MATERNITY+ Style ${i + 1}`,
  }))
}

const carouselRows = productInfos.map((info, index) => ({
  id: `carousel-${index + 1}`,
  productInfo: info,
  items: createCarouselItems(index),
}))
---

<section class={cn('overflow-hidden', className)}>
  <div class="container mx-auto mb-20 mt-24 px-4 md:mb-16">
    <!-- Section Title -->
    <h2
      class="font-display text-center text-3xl font-medium md:text-4xl lg:text-[3.819vw]"
    >
      <span class="text-brown">MATERNITY+</span>
      <br class="md:hidden lg:block" />
      <span class="text-tape-navy-dark">2025FW COLLECTION</span>
    </h2>
  </div>

  <!-- First 3 Carousel Rows -->
  <div class="space-y-12 md:space-y-16">
    {
      carouselRows.slice(0, 3).map((row, index) => (
        <div class="relative px-0">
          <ProductCarousel {...row} rowIndex={index + 1} />
        </div>
      ))
    }
  </div>

  <!-- Unit Images Section -->
  <div class="container mx-auto px-24 py-16 md:py-20" id="unit-images-section">
    <div class="grid grid-cols-5 gap-2">
      <div class="relative unit-image-wrapper">
        <img
          src={unit01.src}
          alt="Collection Unit 1"
          class="unit-image w-full h-full object-cover"
        />
      </div>
      <div class="relative unit-image-wrapper">
        <img
          src={unit02.src}
          alt="Collection Unit 2"
          class="unit-image w-full h-full object-cover"
        />
      </div>
      <div class="relative unit-image-wrapper">
        <img
          src={unit03.src}
          alt="Collection Unit 3"
          class="unit-image w-full h-full object-cover"
        />
      </div>
      <div class="relative unit-image-wrapper">
        <img
          src={unit04.src}
          alt="Collection Unit 4"
          class="unit-image w-full h-full object-cover"
        />
      </div>
      <div class="relative unit-image-wrapper">
        <img
          src={unit05.src}
          alt="Collection Unit 5"
          class="unit-image w-full h-full object-cover"
        />
      </div>
    </div>
  </div>

  <!-- Last 2 Carousel Rows -->
  <div class="space-y-12 md:space-y-16">
    {
      carouselRows.slice(3).map((row, index) => (
        <div class="relative px-0">
          <ProductCarousel {...row} rowIndex={index + 4} />
        </div>
      ))
    }
  </div>

  <!-- New Product Grid Section -->
  <div class="container mx-auto px-4 py-24 flex justify-center">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-[85vw]">
      <!-- Product 1 -->
      <ProductShowcase
        image={collection7}
        imageAlt="CR Utility Pants"
        products={[
          {
            headline: 'UNISEX',
            modelNumber: 'NBM82510',
            title: 'CR Utility Pants',
            copy: '機能性とデザイン性を両立した多機能パンツ',
            price: '¥28,600 (Tax incl.)',
            link: 'https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NBM82510',
          },
          {
            headline: 'UNISEX',
            modelNumber: 'NBM82511',
            title: 'CR Utility Shorts',
            copy: '暖かい季節に最適な多機能ショートパンツ',
            price: '¥22,000 (Tax incl.)',
            link: 'https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NBM82511',
          },
        ]}
        size="sm"
      />

      <!-- Product 2 -->
      <ProductShowcase
        image={collection8}
        imageAlt="Maternity Fleece Jacket"
        headline="WOMENS"
        modelNumber="NAM82510"
        title="Maternity Fleece Jacket"
        copy="妊娠中から産後まで長く着用できるフリースジャケット"
        price="¥22,000 (Tax incl.)"
        link="https://www.goldwin.co.jp/tnf/ec/pro/disp/2/NAM82510"
        size="sm"
      />
    </div>
  </div>
</section>

<style>
  .unit-image-wrapper {
    perspective: 1000px;
  }

  .unit-image {
    transform-origin: top center;
    opacity: 0;
    transform: scale(1.05);
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
  }

  .unit-image.visible {
    opacity: 1;
    transform: scale(1);
  }

  .unit-image.shake-active {
    animation: shake 1200ms;
  }

  @keyframes shake {
    0% {
      transform: rotateZ(0);
    }
    10% {
      transform: rotateZ(-15deg);
    }
    20% {
      transform: rotateZ(7.5deg);
    }
    30% {
      transform: rotateZ(-5deg);
    }
    40% {
      transform: rotateZ(3.75deg);
    }
    50% {
      transform: rotateZ(-3deg);
    }
    60% {
      transform: rotateZ(2.5deg);
    }
    70% {
      transform: rotateZ(-2.14deg);
    }
    80% {
      transform: rotateZ(1.88deg);
    }
    90% {
      transform: rotateZ(-1.67deg);
    }
    100% {
      transform: rotateZ(0);
    }
  }
</style>

<script>
  // Unit Images Shake Animation on Intersection
  document.addEventListener('DOMContentLoaded', () => {
    const unitImages = document.querySelectorAll('.unit-image')
    const imageSection = document.getElementById('unit-images-section')

    if (imageSection && unitImages.length > 0) {
      const observerOptions = {
        root: null,
        rootMargin: '-10% 0px',
        threshold: 0.5,
      }

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            // Add fade-in and shake animation simultaneously
            unitImages.forEach((img, index) => {
              setTimeout(() => {
                // Add both classes at the same time
                img.classList.add('visible', 'shake-active')
                // Remove only the shake class after animation completes
                setTimeout(() => {
                  img.classList.remove('shake-active')
                }, 1200)
              }, index * 100) // Stagger the animations
            })

            // Disconnect observer after triggering once
            observer.disconnect()
          }
        })
      }, observerOptions)

      observer.observe(imageSection)
    }
  })
</script>
